<style>
    span.limit {
        /* if not, seems to apply 120% * 120% */
        font-size: 100%;
    }
    span.late {
        color: red;
    }
    span.close_to_limit {
        color: orange;
    }
    span.on_schedule {
        color: lime;
    }
    span.glyphicon {
        font-weight: normal;
    }
    table.progression tbody span.glyphicon {
        font-size: larger;
    }
    table.progression thead span.glyphicon {
        font-size: smaller;
    }
</style>

<table class="table table-striped table-bordered table-condensed status translucent progression ">
    <thead>
    <tr>
        <th rowspan="2">&nbsp;</th>
        <th>Rob. 1</th>
        <th>Rob. 2</th>
        <th>Rob. 3</th>
        <th>Exposé</th>
    </tr>
    <tr class="planning">
        <th><span class="glyphicon glyphicon-time"></span><span id="planning_rob1" class="limit"> {{ planning.rob1 }}</span></th>
        <th><span class="glyphicon glyphicon-time"></span><span id="planning_rob2" class="limit"> {{ planning.rob2 }}</span></th>
        <th><span class="glyphicon glyphicon-time"></span><span id="planning_rob3" class="limit"> {{ planning.rob3 }}</span></th>
        <th><span class="glyphicon glyphicon-time"></span><span id="planning_research" class="limit"> {{ planning.research }}</span></th>
    </tr>
    </thead>
    <tbody>
    {%if progress %}
        {% set glyphs = ['glyphicon-ok text-success', '', 'glyphicon-time text-danger'] %}
        {% for item in progress %}
        <tr>
            <th class="team-name">{{ item.team_num }} - {{ item.team_name }}</th>
            <td><span class="glyphicon {{ glyphs[item.rob1] }}"></span></td>
            <td><span class="glyphicon {{ glyphs[item.rob2] }}"></span></td>
            <td><span class="glyphicon {{ glyphs[item.rob3] }}"></span></td>
            <td><span class="glyphicon {{ glyphs[item.research] }}"></span></td>
        </tr>
        {% end %}
    {% else %}
        <tr>
            <td colspan="6" class="text-warning">Aucune équipe présente.</td>
        </tr>
    {% end %}
    </tbody>
</table>

<script type="text/javascript">
$(document).ready(function() {
    function to_minutes(s) {
        return parseInt(s.substr(0, 2)) * 60 + parseInt(s.substr(3, 2));
    }
    function check_if_late(elt, clock) {
        var limit = to_minutes(elt.text());
        if (limit - clock > 10) {
            // we have time for the moment
            elt.addClass("on_schedule");
        } else if (limit - clock > 0) {
            // close to the limit
            elt.addClass("close_to_limit");
        } else {
            // we are late
            elt.addClass("late");
        }
    }
    var clock = to_minutes($("#clock").text());
    $("span.limit").each(function(index) {
        check_if_late($(this), clock);
    });
});
</script>
